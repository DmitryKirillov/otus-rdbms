# БД онлайн-сервиса для спортсменов-бегунов

Этот проект является частичным клоном популярной социальной спортивной сети Strava (с рядом упрощений).
Он позволяет спортсменам делиться друг с другом информацией о забегах и маршрутах,
а также анализировать результаты тренировок и соревнований.

Структура таблиц и их полей будет дополняться по мере разработки проекта.

## Диаграмма БД

![alt text](images/diagram.png)

## Таблицы

### users

Таблица пользователей сервиса. Пользователи аутентифицируются по паре "E-mail + пароль", сам
пароль при этом хранится в БД в виде хэша.

### followers_following

Таблица социальных связей между пользователями:

- follower_id – пользователь, который подписался
- following_id – пользователь, на которого подписались

Примеры пользовательских сценариев:

- пользователь начал отслеживать забеги и результаты другого пользователя. 
- пользователь перестал отслеживать забеги и результаты другого пользователя. 

### country_dictionary

Словарь стран мира. В основе лежат трёхсимвольные коды ISO 3166-1. Я рассматривал вариант использования
кода в качестве первичного ключа, но пока не принял окончательное решение.

### city_dictionary

Словарь городов с привязкой к странам.

### locations

Маршруты забегов. Эти маршруты добавляют и именуют сами пользователи. Маршрут должен быть привязан
к конкретной стране, но город – это необязательное поле.

Примеры пользовательских сценариев:

- спортсмен несколько раз провёл тренировки (workouts) в одном и том же месте 
  и хочет создать на их основе маршрут
- организаторы забега создают маршрут для будущих соревнований (races)

### workouts

Конкретные забеги. Их добавляют сами пользователи, обычно – путём импорта данных из спортивных приложений.
Забеги могут, но не обязаны, быть привязаны к маршруту (locations).
Статистические данные (total_distance и total_time) – это денормализованные значения,
которые вычисляются на основе импортированных данных.

Примеры пользовательских сценариев:

- пользователь загрузил с помощью приложения данные о последнем забеге
- пользователь изменил наименование забега
- сервис сформировал аналитические данные на основе ряда забегов

### tracks

Наборы данных, импортированных из спортивных приложений. Каждый набор данных привязан
к конкретному забегу. 

Эта таблица будет постепенно дополняться новыми полями по мере анализа задачи.

### track_points

Спортивные приложения по мере забега фиксируют GPS-координаты бегуна с дополнительной информацией
(скорость, высота над уровнем моря, пульс и т.д.). Набор параметров зависит от используемого ПО
и оборудования. Среднее кол-во срезов на один 10-километровый забег – около 1200.

Эта таблица содержит конкретные срезы из импортированного набора данных. В реальном приложении,
скорее всего, использовались бы альтернативные способы хранения "сырых" данных, но для учебных целей
я выбрал именно такой подход.

### races

В этой таблице хранятся спортивные соревнования. Время начала соревнования – start_time.

Примеры пользовательских сценариев:

- организаторы соревнования создали новое соревнование и привязали его к маршруту
- пользователи приняли участие в соревнованиях и прикрепили свой забег
- пользователи изучают список победителей

## race_participants

В этой таблице хранятся участники спортивных соревнований (они прикрепляют свои забеги к соревнованию).

## Рекомендации к использованию репликации

Наиболее типичный сценарий использования сервиса – это чтение данных + базовая аналитика. Добавление
и изменение данных происходит намного реже и будет выполняться в асинхронном режиме.
Задержка между сохранением данных и их отображением вполне допустима.

В связи с этим оптимальный вариант репликации на этапе разработки MVС:

- один master; работает только на запись
- 2 slave; работают только на чтение

## Рекомендации к резервному копированию

На этапе разработки MVC требования к резервному копированию выглядят следующим образом:

- настройка Point-in-Time Recovery
- полная резервная копия 1 раз в сутки (выгрузка SQL-дампов на внешний сервер)
- учения по разворачиванию резервной копии – 1 раз в неделю